!function(c,a){var _={cache:function(){_.els={},_.els.document=c(a),_.els.document_body=c(a.body),_.els.reservation_table=c(".jckwds-reserve"),_.els.reservation_table_rows=_.els.reservation_table.find("tr"),_.els.reservation_table_prev=c(".jckwds-prevday"),_.els.reservation_table_next=c(".jckwds-nextday"),_.els.date_picker=c("#jckwds-delivery-date"),_.els.date_ymd=c("#jckwds-delivery-date-ymd"),_.els.timeslot_select=c("#jckwds-delivery-time"),_.els.timeslot_select_wrapper=c("#jckwds-delivery-time-wrapper"),_.els.timeslot_field_row=c("#jckwds-delivery-time_field"),_.els.checkout_fields=c("#jckwds-fields"),_.els.fields_hidden=c('[name="iconic-wds-fields-hidden"]'),_.els.ship_to_different_address_checkbox=c("#ship-to-different-address-checkbox"),_.els.shipping_postcode_field=c("#shipping_postcode"),_.els.billing_postcode_field=c("#billing_postcode"),_.els.multi_step_checkout=c("#wizard"),_.els.calender_wrap=c(".jckwds-reserve-wrap")},common_vars:function(){_.vars={},_.vars.is_checkout=_.els.document_body.hasClass("woocommerce-checkout")||_.els.document_body.hasClass("checkout-wc"),_.vars.has_multi_step=0<_.els.multi_step_checkout.length,_.vars.inactive_class="jckwds-fields-inactive",_.vars.chosen_shipping_method=!1,_.vars.set_date_flag=!1},on_load:function(){_.cache(),_.common_vars(),_.setup_reservation_table(),_.setup_checkout(),_.setup_multi_step_checkout()},setup_reservation_table:function(){_.els.reservation_table.length<=0||(_.setup_prev_next(),_.setup_reserve_button(),_.load_reserved_slot())},load_reserved_slot:function(){if(0===_.els.calender_wrap.length)return!1;_.els.calender_wrap.block({message:null,overlayCSS:{opacity:.6}});jQuery.post(jckwds_vars.ajax_url,{action:"iconic_wds_get_reserved_slot"},function(e){e.success&&(c(".jckwds-reserved").removeClass("jckwds-reserved"),c('[data-timeslot-id="'+e.data.id+'"]').addClass("jckwds-reserved")),_.els.calender_wrap.unblock()})},setup_checkout:function(){_.vars.is_checkout&&!_.vars.has_multi_step&&(_.setup_checkout_fields(),_.watch_update_checkout())},setup_multi_step_checkout:function(){c(a.body).on("cfw_updated_checkout",function(){_.cache(),_.unblock_checkout(),c("#jckwds-delivery-date").hasClass("hasDatepicker")||_.setup_date_picker()}),_.vars.is_checkout&&_.vars.has_multi_step&&_.els.multi_step_checkout.init(function(){_.cache(),_.common_vars(),_.setup_checkout_fields(),_.watch_update_checkout()})},setup_prev_next:function(){_.els.reservation_table_prev.on("click",function(){return c.each(_.els.reservation_table_rows,function(){var e=c(this).find(".colVis:first").index();1!==e&&(c(this).children().eq(e-1).addClass("colVis"),c(this).find(".colVis:last").removeClass("colVis"))}),!1}),_.els.reservation_table_next.on("click",function(){c(".jckwds-reserve thead tr .colVis:last").index(),c(".jckwds-reserve thead tr .colVis:first").index();return c.each(_.els.reservation_table_rows,function(){var e=c(this).find(".colVis:last").index();e+1<c(this).children().length&&(c(this).children().eq(e+1).addClass("colVis"),c(this).find(".colVis:first").removeClass("colVis"))}),!1})},setup_reserve_button:function(){_.els.document.on("click",".jckwds-reserve-slot",function(){return _.activate_slot(c(this)),!1})},activate_slot:function(e){var s=e.parent(),t=s.html(),a=s.attr("data-timeslot-id"),d=s.attr("data-timeslot-date"),i=s.attr("data-timeslot-start-time"),r=s.attr("data-timeslot-end-time"),o=(e.closest(".jckwds-reserve-wrap"),{action:"iconic_wds_remove_reserved_slot",nonce:jckwds_vars.ajax_nonce});e.hide().after('<div class="jckwds_loading"><i class="jckwds-icn-loading animate-spin"></i></div>'),jQuery.post(jckwds_vars.ajax_url,o,function(e){e.success&&(_.els.document_body.trigger("reservation_removed"),e={action:"iconic_wds_reserve_slot",nonce:jckwds_vars.ajax_nonce,slot_id:a,slot_date:d,slot_start_time:i,slot_end_time:r},jQuery.post(jckwds_vars.ajax_url,e,function(e){c("td.jckwds-reserved").removeClass("jckwds-reserved"),e.success?s.addClass("jckwds-reserved").html(t):s.addClass("jckwds_full").html('<i class="jckwds-icn-lock"></i>'),_.els.document_body.trigger("reservation_added",e)}))})},setup_checkout_fields:function(){_.setup_date_picker(),_.setup_timeslot_select()},setup_date_picker:function(){_.els.date_picker.datepicker({defaultDate:jckwds_vars.bookable_dates[0],minDate:jckwds_vars.bookable_dates[0],maxDate:jckwds_vars.bookable_dates[jckwds_vars.bookable_dates.length-1],beforeShow:function(e,s){var t=0<=c.inArray(jckwds_vars.settings.datesettings_datesettings_setup_uitheme,["none","dark","light"])?jckwds_vars.settings.datesettings_datesettings_setup_uitheme:"dark";s.dpDiv.addClass("iconic-wds-datepicker iconic-wds-datepicker--"+t)},beforeShowDay:function(e){var s=c.datepicker.formatDate(jckwds_vars.settings.datesettings_datesettings_dateformat,e,{monthNames:jckwds_vars.strings.months,monthNamesShort:jckwds_vars.strings.months_short,dayNames:jckwds_vars.strings.days,dayNamesShort:jckwds_vars.strings.days_short,dayNamesMin:jckwds_vars.strings.days_short}).toString(),t="iconic-wds-date";if(_.is_date_available(s)){e=_.get_fee_for_date(e);return e&&(t+=" iconic-wds-date--fee"),[!0,t,e?jckwds_vars.strings.available+": +"+e:jckwds_vars.strings.available]}return[!1,t,jckwds_vars.strings.unavailable]},dateFormat:jckwds_vars.settings.datesettings_datesettings_dateformat,onSelect:function(e,s){c(this).trigger("change"),""!==this.value&&(s=[_.pad_left(s.selectedYear,4),_.pad_left(s.selectedMonth+1,2),_.pad_left(s.selectedDay,2)].join(""),_.els.date_ymd.val(s),_.vars.set_date_flag?_.vars.set_date_flag=!1:_.is_true(jckwds_vars.settings.timesettings_timesettings_setup_enable)?_.update_timeslot_options(s):_.els.document_body.trigger("update_checkout"))},monthNames:jckwds_vars.strings.months,monthNamesShort:jckwds_vars.strings.months_short,dayNames:jckwds_vars.strings.days,dayNamesShort:jckwds_vars.strings.days_short,dayNamesMin:jckwds_vars.strings.days_short,firstDay:_.get_first_day_of_the_week(),duration:0}),c.datepicker.setDefaults(c.datepicker.regional[""]),_.els.date_picker.datepicker(c.datepicker.regional[""]),c(".ui-datepicker").addClass("notranslate")},is_true:function(e){return!(!e||0===e||"0"===e||""===e||e.length<=0)},get_fee_for_date:function(e){var s=e.getDay(),t=c.datepicker.formatDate(jckwds_vars.settings.datesettings_datesettings_dateformat,e,{monthNames:jckwds_vars.strings.months,monthNamesShort:jckwds_vars.strings.months_short,dayNames:jckwds_vars.strings.days,dayNamesShort:jckwds_vars.strings.days_short,dayNamesMin:jckwds_vars.strings.days_short}).toString(),e=t.replace(/\//g,""),s=void 0!==jckwds_vars.day_fees[e]?parseFloat(jckwds_vars.day_fees[e]):parseFloat(jckwds_vars.day_fees[s]);return t===jckwds_vars.dates.same_day&&0<jckwds_vars.settings.datesettings_fees_same_day.length&&(s+=parseFloat(jckwds_vars.settings.datesettings_fees_same_day)),t===jckwds_vars.dates.next_day&&0<jckwds_vars.settings.datesettings_fees_next_day.length&&(s+=parseFloat(jckwds_vars.settings.datesettings_fees_next_day)),!isNaN(s)&&accounting.formatMoney(s,jckwds_vars.currency)},set_date:function(e){if(e.length<=0||!_.is_date_available(e,!1))return _.els.date_picker.blur().datepicker("hide").datepicker("setDate",null),_.els.date_ymd.val(""),void _.clear_timeslots(jckwds_vars.strings.selectdate);_.vars.set_date_flag=!0,e=c.datepicker.parseDate(jckwds_vars.settings.datesettings_datesettings_dateformat,e,{monthNames:jckwds_vars.strings.months,monthNamesShort:jckwds_vars.strings.months_short,dayNames:jckwds_vars.strings.days,dayNamesShort:jckwds_vars.strings.days_short,dayNamesMin:jckwds_vars.strings.days_short}),_.els.date_picker.blur().datepicker("hide").datepicker("setDate",e),c(".ui-datepicker .ui-state-active").click()},is_date_available:function(t){if(jckwds_vars.bookable_dates.length<=0)return!1;var a=!1;return t=t.toLowerCase(),c.each(jckwds_vars.bookable_dates,function(e,s){if(!1===a&&s.toLowerCase()===t)return!(a=!0)}),a},update_timeslot_options:function(e,s){var t=_.els.timeslot_select.find("option:eq(0)"),a=_.els.timeslot_select.val(),d=(_.els.ship_to_different_address_checkbox.is(":checked")?c("#shipping_postcode"):c("#billing_postcode")).val();_.clear_timeslots(jckwds_vars.strings.loading),_.els.timeslot_select.attr("disabled","disabled").trigger("change",["update_timeslots"]);d={action:"iconic_wds_get_slots_on_date",nonce:jckwds_vars.ajax_nonce,date:e,postcode:d};jQuery.post(jckwds_vars.ajax_url,d,function(e){!0===e.success?(_.clear_timeslots(jckwds_vars.strings.selectslot),_.els.timeslot_select.append(e.html),a=0<_.els.timeslot_select.find('option[value="'+a+'"]').length?a:0,_.els.timeslot_select.val(a),e.reservation&&0<_.els.timeslot_select.find("option[value='"+e.reservation+"']").length&&_.els.timeslot_select.val(e.reservation),_.els.document_body.trigger("update_checkout")):t.text(jckwds_vars.strings.noslots),_.els.document_body.trigger("timeslots_loaded"),_.els.timeslot_select.removeAttr("disabled").trigger("change",["update_timeslots"]),void 0!==s&&s(e)})},refresh_timeslots:function(e){e=void 0!==e&&e,_.els.timeslot_field_row.hasClass("jckwds-delivery-time--has-reservation")&&!1===e?_.els.timeslot_field_row.removeClass("jckwds-delivery-time--has-reservation"):(void 0!==(e=_.els.date_ymd.val())&&""!==e&&_.update_timeslot_options(e),_.els.document_body.trigger("timeslots_refreshed"))},clear_date:function(){_.els.date_ymd.val(""),_.set_date("")},clear_timeslots:function(e){_.els.timeslot_select.children().not(":first").remove(),"string"==typeof e&&_.els.timeslot_select.find("option:eq(0)").text(e)},setup_timeslot_select:function(){_.els.timeslot_select.on("change",function(e,s){"update_timeslots"!==(s=void 0!==s&&s)&&_.els.document_body.trigger("update_checkout")})},watch_update_checkout:function(){_.els.document_body.on("update_checkout",function(e){_.block_checkout()}),_.els.document_body.on("updated_checkout",function(e,s){c("#jckwds-delivery-date").hasClass("hasDatepicker")||_.setup_date_picker(),_.update_checkout_field_labels(s.fragments.iconic_wds.labels),s.fragments.iconic_wds.chosen_shipping_method!==_.vars.chosen_shipping_method?(_.vars.chosen_shipping_method=s.fragments.iconic_wds.chosen_shipping_method.toString(),_.toggle_date_time_fields(s.fragments.iconic_wds,function(e){e&&_.refresh_datepicker(s.fragments.iconic_wds.bookable_dates,function(){_.refresh_timeslots(!0)}),_.unblock_checkout()})):_.unblock_checkout()}),_.els.checkout_fields.hasClass(_.vars.inactive_class)&&_.hide_date_time_fields()},block_checkout:function(){_.els.checkout_fields.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c("#place_order").attr("disabled","disabled")},unblock_checkout:function(){_.els.checkout_fields.unblock({fadeOut:0}),c("#place_order").removeAttr("disabled")},update_checkout_field_labels:function(e){var a;e.length<=0||(a={details:c(".iconic-wds-fields__title"),date:c(".jckwds-delivery-date label"),select_date:c("#jckwds-delivery-date"),choose_date:c("#jckwds-delivery-date-description"),time_slot:c(".jckwds-delivery-time label"),choose_time_slot:c(" #jckwds-delivery-time-description")},c.each(e,function(e,s){if(void 0===a[e])return!0;if(a[e].is("input"))return a[e].attr("placeholder",s),!0;var t=a[e].find("*");a[e].text(s),0<t.length&&a[e].append("&nbsp;").append(t)}))},refresh_datepicker:function(e,s){jckwds_vars.bookable_dates=e,_.els.date_picker.blur().datepicker("hide").datepicker("option","defaultDate",e[0]).datepicker("option","minDate",e[0]).datepicker("option","maxDate",e[e.length-1]),jckwds_vars.reserved_slot?-1!==c.inArray(jckwds_vars.reserved_slot.date.formatted,jckwds_vars.bookable_dates)&&_.set_date(jckwds_vars.reserved_slot.date.formatted):(e=_.els.date_picker.val(),_.set_date(e)),void 0!==s&&s()},clear_date_time_fields:function(){_.clear_date(),_.clear_timeslots()},toggle_date_time_fields:function(e,s){if(!jckwds_vars.needs_shipping||c.inArray("any",jckwds_vars.settings.general_setup_shipping_methods)<0&&c.inArray(_.vars.chosen_shipping_method,jckwds_vars.settings.general_setup_shipping_methods)<0)return _.hide_date_time_fields(),void("function"==typeof s&&s(!1,{index:!0}));_.show_date_time_fields(),e.slots_allowed?_.show_date_time_fields():_.hide_date_time_fields(),"function"==typeof s&&s(e.slots_allowed)},hide_date_time_fields:function(){_.els.checkout_fields.removeClass(_.vars.inactive_class).removeClass("woocommerce-billing-fields").hide(),_.els.fields_hidden.val(1),_.clear_date_time_fields()},show_date_time_fields:function(){_.els.checkout_fields.addClass("woocommerce-billing-fields").show(),_.els.fields_hidden.val(0)},get_last_day_of_the_week:function(){var e={monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6,sunday:0};return void 0===jckwds_vars.settings.datesettings_datesettings_last_day_of_week||void 0===e[jckwds_vars.settings.datesettings_datesettings_last_day_of_week]?6:e[jckwds_vars.settings.datesettings_datesettings_last_day_of_week]},get_first_day_of_the_week:function(){var e=_.get_last_day_of_the_week();return 6===e?0:e+1},pad_left:function(e,s,t){return new Array(s-String(e).length+1).join(t||"0")+e},checkout_error:function(){var e=c('[data-iconic-wds-clear-date="1"]'),s=c('[data-iconic-wds-clear-time="1"]'),t=c('[data-iconic-wds-update-checkout="1"]');e.length<=0&&s.length<=0&&t.length<=0||(0<e.length&&_.clear_date(),0<s.length&&_.refresh_timeslots(!0),0<t.length&&c(a.body).trigger("update_checkout"))}};c(window).on("load",_.on_load),c(a.body).on("checkout_error",_.checkout_error)}(jQuery,document);